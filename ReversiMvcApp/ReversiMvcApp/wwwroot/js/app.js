"use strict";function _createForOfIteratorHelper(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=c.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Game=function(){var i,c={gameState:null,prev:null,gameId:"02af7930-6faf-45a8-bf90-961cc5e40beb",playerId:""};function n(){return(1===c.gameState.aandeBeurt?c.gameState.speler1Token:c.gameState.speler2Token)===c.playerId}function r(){var a=null===c.gameState;Game.Model.getGameState(c.gameId).then(function(e){if(Game.Model.getAfgelopen(c.gameId).then(function(e){e&&(console.log("afgelopen: ",e),u(),clearInterval(i))}),c.gameState=e,l(),a)Game.Reversi.renderBoard(c.gameState.bord);else for(var t=0;t<8;t++)for(var n=0;n<8;n++){var r=c.prev.bord[n][t],o=c.gameState.bord[n][t];r!==o&&Game.Reversi.showFiche(t,n,o)}c.prev=c.gameState}).catch(function(e){return console.error(e)})}var l=function(){var e=document.getElementById("beurt"),t=n();t?($(e).removeClass("beurt--jouw"),$(e).addClass("beurt--mijn")):($(e).removeClass("beurt--mijn"),$(e).addClass("beurt--jouw")),e.innerText=t?"Je bent aan de beurt":"De ander is aan de beurt"},u=function(){var e=c.gameState.bord.map(function(e){return e.filter(function(e){return 1===e}).length}).reduce(function(e,t){return e+t}),t=c.gameState.bord.map(function(e){return e.filter(function(e){return 2===e}).length}).reduce(function(e,t){return e+t}),n=c.gameState.speler1Token===c.playerId,r=document.getElementById("beurt"),r=(r.innerHTML=t<e?n?"🔥🎊🔥🙌🎈🍻 Gewonnen! 🔥🎊🔥🙌🎈🍻":"Je hebt verloren 😢😔":e<t?n?"Je hebt verloren 😢😔":"🔥🎊🔥🙌🎈🍻 Gewonnen! 🔥🎊🔥🙌🎈🍻":"Gelijk spel",document.getElementById("leaveButton"));r.innerText="Spel Verlaten ✅🏁",r.removeAttribute("onclick"),r.onclick=function(e){$.get("https://localhost:44334/Spel/Finish/".concat(c.gameId)).then(function(e){return window.location="/"})}};return{init:function(e,t){c.gameId=e,c.playerId=t,Game.Data.init("https://localhost:44333","production"),Game.Model.init(),Game.Template.init(),Game.API.init(),Game.Reversi.init(),document.getElementById("leaveButton").onclick=function(e){$.get("https://localhost:44334/Spel/Verlaten/".concat(c.gameId,"?spelerToken=").concat(c.playerId)).then(function(e){return window.location="/"})},r(),i=setInterval(r,2e3)},placeFiche:function(e,t){if(console.log("Placee fiche at x:".concat(e,", y:").concat(t)),document.getElementById("beurt").innerText="Laden...",console.log("aan de beurt: "+n()),n())return Game.Data.put("/api/spel/".concat(c.gameId,"/zet?token=").concat(c.playerId,"&kolom=").concat(e,"&rij=").concat(t)),""}}}(),FeedbackWidget=function(){function t(e){_classCallCheck(this,t),this._elementId=e}return _createClass(t,[{key:"elementId",get:function(){return this._elementId}},{key:"show",value:function(e,t){var n=$("#"+this._elementId),r=$("#alert-message");$(n).fadeIn("slow"),r.text(e),r.addClass("yeet"),"danger"===t?($(n).addClass("feedback-widget--state-danger"),$(n).removeClass("feedback-widget--state-succes")):"success"===t&&($(n).addClass("feedback-widget--state-succes"),$(n).removeClass("feedback-widget--state-danger")),this.log({message:e,type:t})}},{key:"hide",value:function(){var e=document.getElementById(this._elementId);$(e).fadeOut("slow")}},{key:"log",value:function(e){var t=JSON.parse(localStorage.getItem("feedback_widget"));null==t?localStorage.setItem("feedback_widget",JSON.stringify([e])):(t.push(e),10<t.length&&t.shift(),this.removelog(),localStorage.setItem("feedback_widget",JSON.stringify(t)))}},{key:"removelog",value:function(){localStorage.removeItem("feedback_widget")}},{key:"history",value:function(){var e=(null!=(e=JSON.parse(localStorage.getItem("feedback_widget")))?e:[]).map(function(e){return"".concat(e.type," - ").concat(e.message)}).join("\n");console.log(e)}}]),t}();Game.API=function(){function t(){return(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Game.Data.isEven(t);case 2:return n=e.sent,e.abrupt("return",n.iseven);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{init:function(){console.log("from game.api.init!")},isEven:function(e){return t.apply(this,arguments)}}}(),Game.Data=function(){function t(t){var n=r.mock.find(function(e){return e.url===t}).data;return new Promise(function(e,t){e(n)})}var n={environment:"development"},r={url:"",apiKey:"<plaats hier je apikey>",mock:[{url:"/api/spel/beurt",data:0}]};return{init:function(e,t){if(r.url=e,"production"!==t&&"development"!==t)throw new Error("environment must be production or development");n.environment=t,console.log(n.environment+" environment"),console.log("from game.data.init!")},get:function(e){return"development"===n.environment?t(e):"production"===n.environment?$.get(r.url+e).then(function(e){return e}).catch(function(e){console.log(e.message)}):void 0},put:function(e){return"development"===n.environment?t(e):(console.log("url: "+e),new Promise(function(t){$.ajax({url:r.url+e,type:"PUT",success:function(e){t(e)}})}))}}}(),Game.Model={init:function(){console.log("from game.model.init!")},getGameState:function(e){return new Promise(function(u,s){Game.Data.get("/api/spel/".concat(null!=e?e:"")).then(function(e){for(var t,n=e.aandeBeurt,r=e,o=r.bord,a=[],i=0;i<8;i++)a.push([0,0,0,0,0,0,0,0]);for(t in o){var c=o[t],l=t.split(",");a[l[0]][l[1]]=c}r.bord=a,0===n||1===n||2===n?u(e):(console.error("Game.Model.getGameState: Error fetching gamestate"),s("Invalid gamestate or failed request."))}).catch(function(e){return s(e)})})},getAfgelopen:function(e){return new Promise(function(t,n){Game.Data.get("/api/Afgelopen/".concat(null!=e?e:"")).then(function(e){t(e)}).catch(function(e){return n(e)})})}},Game.Reversi=function(){var r="board.body";return{init:function(){console.log("from game.reversi.init!")},renderBoard:function(e){document.querySelector(".board").innerHTML=Game.Template.parseTemplate(r,{board:e});for(var t=function(r){for(var e=0;e<8;e++)!function(t){var n=document.querySelector(".board__row__element--y-".concat(r,".board__row__element--x-").concat(t));n.addEventListener("click",function(e){0<n.children.length||Game.placeFiche(t,r)})}(e)},n=0;n<8;n++)t(n)},showFiche:function(e,t,n){t=document.querySelector(".board__row__element--y-".concat(t,".board__row__element--x-").concat(e)),(e=document.createElement("div")).classList.add("fiche"),e.classList.add("fiche--".concat(n)),t.innerHTML="",t.append(e)}}}(),Game.Template=function(){function n(e){var t,n=spa_templates.templates,r=_createForOfIteratorHelper(e.split("."));try{for(r.s();!(t=r.n()).done;)n=n[t.value]}catch(e){r.e(e)}finally{r.f()}return n}return{init:function(){Handlebars.registerHelper("ifeq",function(e,t,n){return e===t?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("ifnoteq",function(e,t,n){return e!==t?n.fn(this):n.inverse(this)})},getTemplate:n,parseTemplate:function(e,t){return console.log("parsing template for: ".concat(null!=e?e:"undefined")),n(e)(t)}}}();